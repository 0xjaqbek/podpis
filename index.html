<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historia Medyczna i Formularz Zgody</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/4.1.5/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .signature-container {
            border: 2px solid #ddd;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        canvas {
            width: 100%;
            height: 200px;
            border-radius: 4px;
        }
        
        .buttons {
            margin-top: 10px;
        }
        
        button {
            padding: 10px 20px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .submit-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .clear-btn {
            background-color: #f44336;
            color: white;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>Historia Medyczna i Formularz Zgody</h1>
    
    <form id="medicalForm" onsubmit="return handleSubmit(event)">
        <div class="form-group">
            <label for="name">Imię i Nazwisko:</label>
            <input type="text" id="name" required>
        </div>

        <div class="form-group">
            <label for="pesel">PESEL:</label>
            <input type="text" id="pesel" maxlength="11" required>
        </div>

        <div class="form-group">
            <label for="dob">Data urodzenia:</label>
            <input type="date" id="dob" required>
        </div>

        <div class="form-group">
            <label for="address">Adres zamieszkania:</label>
            <input type="text" id="address" required>
        </div>

        <div class="form-group">
            <label>Czy występują choroby przewlekłe?</label>
            <div>
                <input type="radio" id="conditions-yes" name="conditions" value="tak">
                <label for="conditions-yes">Tak</label>
                <input type="radio" id="conditions-no" name="conditions" value="nie">
                <label for="conditions-no">Nie</label>
            </div>
        </div>

        <div class="form-group">
            <label for="conditions-description">Jeśli tak, proszę wymienić:</label>
            <textarea id="conditions-description" rows="3"></textarea>
        </div>

        <div class="form-group">
            <label for="medications">Przyjmowane leki:</label>
            <textarea id="medications" rows="3"></textarea>
        </div>

        <div class="form-group">
            <label for="allergies">Alergie:</label>
            <textarea id="allergies" rows="3"></textarea>
        </div>

        <div class="form-group">
            <h3>Zgoda na świadczenia medyczne</h3>
            <p>Ja, niżej podpisany(a), wyrażam zgodę na udzielanie świadczeń zdrowotnych. Potwierdzam, że zostałem(am) poinformowany(a) o moim stanie zdrowia, proponowanych metodach diagnostycznych i leczniczych oraz o możliwych powikłaniach i ryzyku. Oświadczam również, że podane przeze mnie informacje są zgodne z prawdą.</p>
            
            <p>Wyrażam zgodę na przetwarzanie moich danych osobowych zgodnie z ustawą o ochronie danych osobowych w celu udzielania świadczeń zdrowotnych i prowadzenia dokumentacji medycznej.</p>
        </div>

        <div class="signature-container">
            <label>Podpis pacjenta:</label>
            <canvas id="signaturePad"></canvas>
        </div>

        <div class="buttons">
            <button type="button" class="clear-btn" onclick="clearSignature()">Wyczyść podpis</button>
            <button type="submit" class="submit-btn">Generuj PDF</button>
        </div>
    </form>

    <script>
        let signaturePad;
        const { jsPDF } = window.jspdf;
        
        window.onload = function() {
            const canvas = document.getElementById('signaturePad');
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)'
            });
            
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
                signaturePad.clear();
            }
            
            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();
        }
        
        function clearSignature() {
            signaturePad.clear();
        }
        
        function handleSubmit(event) {
            event.preventDefault();
            
            if (signaturePad.isEmpty()) {
                alert('Proszę złożyć podpis');
                return false;
            }
            
            // Create PDF
            const doc = new jsPDF();
            
            // Add title
            doc.setFont("helvetica");
            doc.setFontSize(20);
            doc.text('Historia Medyczna i Formularz Zgody', 20, 20);
            
            // Add form data
            doc.setFontSize(12);
            let yPosition = 40;
            
            // Add patient information
            doc.text(`Imię i Nazwisko: ${document.getElementById('name').value}`, 20, yPosition);
            yPosition += 10;
            
            doc.text(`PESEL: ${document.getElementById('pesel').value}`, 20, yPosition);
            yPosition += 10;
            
            doc.text(`Data urodzenia: ${document.getElementById('dob').value}`, 20, yPosition);
            yPosition += 10;

            doc.text(`Adres: ${document.getElementById('address').value}`, 20, yPosition);
            yPosition += 15;
            
            const hasConditions = document.querySelector('input[name="conditions"]:checked')?.value || 'nie określono';
            doc.text(`Choroby przewlekłe: ${hasConditions}`, 20, yPosition);
            yPosition += 10;
            
            const conditions = document.getElementById('conditions-description').value;
            if (conditions) {
                const conditionsLines = doc.splitTextToSize(conditions, 170);
                doc.text(conditionsLines, 20, yPosition);
                yPosition += (conditionsLines.length * 7);
            }
            yPosition += 5;
            
            // Add medications
            const medications = document.getElementById('medications').value;
            doc.text('Przyjmowane leki:', 20, yPosition);
            yPosition += 7;
            const medicationLines = doc.splitTextToSize(medications || 'Brak', 170);
            doc.text(medicationLines, 20, yPosition);
            yPosition += (medicationLines.length * 7) + 5;
            
            // Add allergies
            const allergies = document.getElementById('allergies').value;
            doc.text('Alergie:', 20, yPosition);
            yPosition += 7;
            const allergyLines = doc.splitTextToSize(allergies || 'Brak', 170);
            doc.text(allergyLines, 20, yPosition);
            yPosition += (allergyLines.length * 7) + 15;
            
            // Add consent text
            const consentText = "Ja, niżej podpisany(a), wyrażam zgodę na udzielanie świadczeń zdrowotnych. Potwierdzam, że zostałem(am) poinformowany(a) o moim stanie zdrowia, proponowanych metodach diagnostycznych i leczniczych oraz o możliwych powikłaniach i ryzyku. Oświadczam również, że podane przeze mnie informacje są zgodne z prawdą.";
            const consentLines = doc.splitTextToSize(consentText, 170);
            doc.text(consentLines, 20, yPosition);
            yPosition += (consentLines.length * 7) + 10;

            const privacyText = "Wyrażam zgodę na przetwarzanie moich danych osobowych zgodnie z ustawą o ochronie danych osobowych w celu udzielania świadczeń zdrowotnych i prowadzenia dokumentacji medycznej.";
            const privacyLines = doc.splitTextToSize(privacyText, 170);
            doc.text(privacyLines, 20, yPosition);
            yPosition += (privacyLines.length * 7) + 15;
            
            // Add signature
            doc.text('Podpis pacjenta:', 20, yPosition);
            const signatureData = signaturePad.toDataURL();
            doc.addImage(signatureData, 'PNG', 20, yPosition + 5, 50, 20);
            
            // Add date
            const currentDate = new Date().toLocaleDateString('pl-PL');
            doc.text(`Data: ${currentDate}`, 20, yPosition + 30);
            
            // Download the PDF
            const fileName = `zgoda_medyczna_${document.getElementById('name').value.replace(/\s+/g, '_')}.pdf`;
            doc.save(fileName);
            
            return false;
        }
    </script>
</body>
</html>
