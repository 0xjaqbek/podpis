<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical History & Consent Form</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/4.1.5/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .signature-container {
            border: 2px solid #ddd;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        canvas {
            width: 100%;
            height: 200px;
            border-radius: 4px;
        }
        
        .buttons {
            margin-top: 10px;
        }
        
        button {
            padding: 10px 20px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .submit-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .clear-btn {
            background-color: #f44336;
            color: white;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>Medical History & Consent Form</h1>
    
    <form id="medicalForm" onsubmit="return handleSubmit(event)">
        <div class="form-group">
            <label for="name">Full Name:</label>
            <input type="text" id="name" required>
        </div>

        <div class="form-group">
            <label for="dob">Date of Birth:</label>
            <input type="date" id="dob" required>
        </div>

        <div class="form-group">
            <label>Do you have any medical conditions?</label>
            <div>
                <input type="radio" id="conditions-yes" name="conditions" value="yes">
                <label for="conditions-yes">Yes</label>
                <input type="radio" id="conditions-no" name="conditions" value="no">
                <label for="conditions-no">No</label>
            </div>
        </div>

        <div class="form-group">
            <label for="medications">Current Medications:</label>
            <textarea id="medications" rows="3"></textarea>
        </div>

        <div class="form-group">
            <label for="allergies">Allergies:</label>
            <textarea id="allergies" rows="3"></textarea>
        </div>

        <div class="form-group">
            <h3>Consent</h3>
            <p>I hereby confirm that the information provided above is accurate and complete to the best of my knowledge. I consent to medical treatment and understand the associated risks.</p>
        </div>

        <div class="signature-container">
            <canvas id="signaturePad"></canvas>
        </div>

        <div class="buttons">
            <button type="button" class="clear-btn" onclick="clearSignature()">Clear Signature</button>
            <button type="submit" class="submit-btn">Generate PDF</button>
        </div>
    </form>

    <script>
        let signaturePad;
        const { jsPDF } = window.jspdf;
        
        window.onload = function() {
            const canvas = document.getElementById('signaturePad');
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)'
            });
            
            // Adjust canvas size
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
                signaturePad.clear();
            }
            
            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();
        }
        
        function clearSignature() {
            signaturePad.clear();
        }
        
        function handleSubmit(event) {
            event.preventDefault();
            
            if (signaturePad.isEmpty()) {
                alert('Please provide your signature');
                return false;
            }
            
            // Create PDF
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('Medical History & Consent Form', 20, 20);
            
            // Add form data
            doc.setFontSize(12);
            let yPosition = 40;
            
            // Add patient information
            doc.text(`Full Name: ${document.getElementById('name').value}`, 20, yPosition);
            yPosition += 10;
            
            doc.text(`Date of Birth: ${document.getElementById('dob').value}`, 20, yPosition);
            yPosition += 10;
            
            const hasConditions = document.querySelector('input[name="conditions"]:checked')?.value || 'Not specified';
            doc.text(`Medical Conditions: ${hasConditions}`, 20, yPosition);
            yPosition += 10;
            
            // Add medications (with word wrap)
            const medications = document.getElementById('medications').value;
            doc.text('Current Medications:', 20, yPosition);
            yPosition += 10;
            const medicationLines = doc.splitTextToSize(medications || 'None', 170);
            doc.text(medicationLines, 20, yPosition);
            yPosition += (medicationLines.length * 7);
            
            // Add allergies (with word wrap)
            const allergies = document.getElementById('allergies').value;
            doc.text('Allergies:', 20, yPosition);
            yPosition += 10;
            const allergyLines = doc.splitTextToSize(allergies || 'None', 170);
            doc.text(allergyLines, 20, yPosition);
            yPosition += (allergyLines.length * 7) + 10;
            
            // Add consent text
            const consentText = "I hereby confirm that the information provided above is accurate and complete to the best of my knowledge. I consent to medical treatment and understand the associated risks.";
            const consentLines = doc.splitTextToSize(consentText, 170);
            doc.text(consentLines, 20, yPosition);
            yPosition += (consentLines.length * 7) + 10;
            
            // Add signature
            doc.text('Signature:', 20, yPosition);
            const signatureData = signaturePad.toDataURL();
            doc.addImage(signatureData, 'PNG', 20, yPosition + 5, 50, 20);
            
            // Add date
            const currentDate = new Date().toLocaleDateString();
            doc.text(`Date: ${currentDate}`, 20, yPosition + 30);
            
            // Download the PDF
            const fileName = `medical_consent_${document.getElementById('name').value.replace(/\s+/g, '_')}.pdf`;
            doc.save(fileName);
            
            return false;
        }
    </script>
</body>
</html>
